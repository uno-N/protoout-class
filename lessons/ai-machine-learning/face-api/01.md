# Face APIã‚’ä½¿ã£ã¦ã‚¯ãƒ©ã‚¦ãƒ‰AIã«è§¦ã‚Œã¦ã¿ã‚‹

## 1. ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«

- ã‚¯ãƒ©ã‚¦ãƒ‰ã§æ¨è«–ã§ãã‚‹Azure Face APIã‚’ä½¿ã£ã¦ã¿ã‚‹
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å¤‰ãˆã¦ã€ã„ã‚ã‚“ãªå±æ€§ã‚’å–å¾—ã—ã¦ã¿ã‚‹

## 2. Azure Face API

### 2.1. ã–ã£ãã‚ŠAzure

[![Image from Gyazo](https://i.gyazo.com/9928745dd7b6ad0bde8d5f7cc66ea875.png)](https://gyazo.com/9928745dd7b6ad0bde8d5f7cc66ea875)

- MicrosoftãŒæä¾›ã—ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã®ã“ã¨
- 200ä»¥ä¸Šã®ã‚µãƒ¼ãƒ“ã‚¹ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹
- AIãƒ»æ©Ÿæ¢°å­¦ç¿’ç³»ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚‚å……å®Ÿã—ã¦ã„ã‚‹

### 2.2. ã–ã£ãã‚ŠAzure Face API

æ©Ÿèƒ½ã¯å¤§ããåˆ†ã‘ã¦2ã¤ã§ã™ã€‚

- é¡”æ¤œå‡º
  - > ç”»åƒå†…ã®å„é¡”ã®27ã®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚’å«ã‚€ã€ãƒãƒ¼ã‚ºã€é¡”ã®è¦†ã„ã€é¡”ã®æ¯›ãªã©ã®å±æ€§ã¨ã¨ã‚‚ã«ã€1ã¤ä»¥ä¸Šã®äººé–“ã®é¡”ã‚’æ¤œå‡ºã—ã¾ã™ã€‚  
    > <a href="https://gyazo.com/96883a0d6cec3835d1dd226f2787122f"><img src="https://i.gyazo.com/96883a0d6cec3835d1dd226f2787122f.png" alt="Image from Gyazo" width="500"/></a>

- é¡”èªè¨¼
  - > 2ã¤ã®é¡”ãŒåŒä¸€äººç‰©ã®ã‚‚ã®ã§ã‚ã‚‹å¯èƒ½æ€§ã‚’æ¤œè¨¼ã—ã€ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ã‚’å–å¾—ã—ã¾ã™ã€‚  
    > <a href="https://gyazo.com/96b1abceff69a646c7db2de6bc5fb21d"><img src="https://i.gyazo.com/96b1abceff69a646c7db2de6bc5fb21d.png" alt="Image from Gyazo" width="500"/></a>

## 3. é¡”æ¤œå‡ºã—ã¦ã¿ã‚ˆã†

Face APIå®Ÿéš›ã«ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### äº‹å‰æº–å‚™

1. ä¸‹è¨˜è³‡æ–™ã‚’å‚è€ƒã«`ã‚­ãƒ¼`ã¨`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ`ã‚’ç™ºè¡Œã—ã€ãƒ¡ãƒ¢å¸³ãªã©ã«ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã¾ã™ã€‚
   - [Face APIã‚’ä½¿ã£ã¦ã¿ã‚ˆã†](https://zenn.dev/tmitsuoka0423/books/b21e50db77ff1eab89a3/viewer/chapter3#2.3.1.face-apiã‚’ä½¿ã£ã¦ã¿ã‚ˆã†)

### ãƒ—ãƒ­ã‚°ãƒ©ãƒ 

1. å¥½ããªå ´æ‰€ã«`face-api`ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’ä½œæˆã—ã€VS Codeã§é–‹ãã¾ã™ã€‚
    - ä»¥ä¸‹ã®ä½œæ¥­ã¯ã™ã¹ã¦ã€`face-api`ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã§è¡Œã„ã¾ã™ã€‚
1. VS Codeã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
    ```
    npm init -y
    npm i @azure/cognitiveservices-face @azure/ms-rest-azure-js
    ```
1. `index.js`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
1. ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒšã—ã€ä¿å­˜ã—ã¾ã™ã€‚
    ```javascript
    "use strict";

    // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã‚€
    const { FaceClient } = require("@azure/cognitiveservices-face");
    const { CognitiveServicesCredentials } = require("@azure/ms-rest-azure-js");

    // Azure Face APIã‚’ä½¿ã†ãŸã‚ã®æº–å‚™
    const faceKey = "äº‹å‰æº–å‚™ã®ã‚­ãƒ¼ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã‚‹";
    const faceEndPoint = "äº‹å‰æº–å‚™ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã‚‹";
    const cognitiveServiceCredentials = new CognitiveServicesCredentials(faceKey);
    const faceClient = new FaceClient(cognitiveServiceCredentials, faceEndPoint);

    const main = async () => {
      // Azure Face APIã«ç”»åƒã‚’é€ã‚Šã€çµæœã‚’å—ã‘å–ã‚‹
      // ç”»åƒURLã¯å¥½ããªã‚‚ã®ã«å¤‰æ›´ã—ã¦ãã ã•ã„
      const result = await faceClient.face.detectWithUrl("https://prtimes.jp/i/79105/1/resize/d79105-1-505527-7.jpg", {
        returnFaceAttributes: ["smile", "makeup"], // ã“ã“ã«ã‚«ãƒ³ãƒ(,)åŒºåˆ‡ã‚Šã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹
      });

      // resultã«çµæœãŒå…¥ã£ã¦ãã¾ã™
      console.log(result);
      console.log(result[0].faceAttributes.makeup.eyeMakeup);
    };

    main();
    ```

    - TIPS
      - JSONã®æ‰±ã„æ–¹ã¯ä¸‹è¨˜è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¾ã—ã‚‡ã†ã€‚
      - [PUNK APIã§ã‚¯ãƒ©ãƒ•ãƒˆãƒ“ãƒ¼ãƒ«ã®æƒ…å ±ã‚’å–å¾—ã—ãªãŒã‚‰APIåˆ©ç”¨ã‚’å­¦ã¶ğŸ»](https://zenn.dev/n0bisuke/articles/02-punkapi-node-api-learn#%E3%83%93%E3%83%BC%E3%83%AB%E3%81%AE%E5%90%8D%E5%89%8D%E3%81%A8%E7%94%BB%E5%83%8F%E3%81%A0%E3%81%91%E6%AC%B2%E3%81%97%E3%81%84)
    - NOTE
      - :warning:ã‚­ãƒ¼ã¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯å…¬é–‹ã—ãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚:warning:
1. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§`node index.js`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
1. ã“ã‚“ãªæ„Ÿã˜ã®çµæœãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OKã€‚é¡”ãŒæ¤œå‡ºã•ã‚Œã€ä½ç½®ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚
    ```js
    [
      {
        faceId: '17cb701e-71fa-46a7-aa59-c4f62d6ed631',
        recognitionModel: 'recognition_01',
        faceRectangle: { width: 81, height: 81, left: 139, top: 130 }, // <-- é¡”ã®ä½ç½®
        faceAttributes: { smile: 1, makeup: [Object] } // <-- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«æŒ‡å®šã—ãŸæƒ…å ±
      }
    ]
    false // <-- result[0].faceAttributes.makeup.eyeMakeupã®å€¤
    ```

## 4. (æ¼”ç¿’)Azure Face APIã§ä»–ã®æƒ…å ±ã‚’å–å¾—ã—ã¦ã¿ã‚ˆã†(10åˆ†)

1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å¤‰æ›´ã—ã¦ã€ãƒ¡ã‚¬ãƒã‚’æ›ã‘ã¦ã„ã‚‹ã‹ã©ã†ã‹åˆ¤å®šã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
    - `faceAttributes`ã«`glasses`ã‚’è¿½åŠ ã—ã¦ã€å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ã€‚
2. ä»–ã«ã‚‚åˆ¤å®šã§ãã‚‹é …ç›®ãŒãŸãã•ã‚“ã‚ã‚Šã¾ã™ã®ã§ã€è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
    - å„é …ç›®ã®è©³ç´°ã¯ã“ã¡ã‚‰ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
      - [é¡”æ¤œå‡ºã¨é¡”å±æ€§ã®æ¦‚å¿µ - Azure Cognitive Services | Microsoft Docs](https://docs.microsoft.com/ja-jp/azure/cognitive-services/face/concepts/face-detection#attributes)
    - è¨­å®šã§ãã‚‹é …ç›®ä¸€è¦§ã€‚`returnFaceAttributes`ã«ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚
      - ã‚¢ã‚¯ã‚»ã‚µãƒª: `accessories`
      - å¹´é½¢: `age`
      - ã¼ã‹ã—: `blur`
      - æ„Ÿæƒ…: `emotion`
      - éœ²å‡º: `exposure`
      - é¡”ã²ã’: `facialHair`
      - æ€§åˆ¥: `gender`
      - çœ¼é¡: `glasses`
      - é«ªã®æ¯›: `hair`
      - é ­éƒ¨å§¿å‹¢: `headPose`
      - åŒ–ç²§: `makeup`
      - ãƒã‚¤ã‚º: `noise`
      - ã‚ªã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³: `occlusion`
      - ç¬‘é¡”: `smile`

## 5. å‚è€ƒ

- [ç”»åƒåˆ†æAIã‚’ä½¿ã£ãŸLINE Botã‚’1æ™‚é–“ã§ä½œã£ã¦ã¿ã‚ˆã†ï¼ˆé¡”æ¤œå‡ºç·¨ï¼‰ï½ãƒ—ãƒ­ãƒˆã‚¢ã‚¦ãƒˆä½“é¨“ä¼šï½](https://zenn.dev/tmitsuoka0423/books/b21e50db77ff1eab89a3)

---

## ç›®æ¬¡ã¸

[ç›®æ¬¡](https://github.com/protoout/po-common/tree/main/lessons)ã«æˆ»ã‚Šã¾ã™
